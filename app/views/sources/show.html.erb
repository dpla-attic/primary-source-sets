<% content_for :head_script do %>
  <title><%= plaintext_from_md(@source.name) %></title>
  <meta name='description' content="This <%= @source.main_asset.class.name.downcase %> is part of '<%= strip_tags(inline_markdown(@source.source_set.name)) %>', a primary source set for educational use." />
  <link rel='canonical' href='<%= url_for(controller: 'sources',
                                          action: 'show',
                                          id: @source.id,
                                          only_path: false,
                                          trailing_slash: true) %>' /> 
<% end %>

<% content_for :foot_script do %>
  <%= javascript_include_tag 'lightbox' %>
  <%= render partial: 'shared/analytics' %>
<% end %>

<div class="breadcrumbs">
  <%= render_breadcrumbs separator: ' / ' %>
</div>

<div class='source'>
  <h1><%= inline_markdown(@source.display_name) %></h1>

  <%= render_media_asset %>

  <aside>
    <div class='module blue line'>
      <div class='moduleSection wrap'>
        <h2>Citation information</h2>
        <%= markdown(@source.citation) %>
        <h2>Credits</h2>
        <%= markdown(@source.credits) %>
        <h2>Need more information?</h2>
        <%= link_to 'View the description of this item in DPLA',
                    frontend_path('item/' + @source.aggregation) %>
      </div>
    </div>
  </aside>

  <div class='textual-content'>
    <%= markdown(@source.textual_content) %>
  </div>
</div>

<% if admin_signed_in? %>
  <h2>Admin info</h2>

  <% unless current_admin.reviewer? %>
    <p>
      <%= link_to "Edit", edit_source_path(@source) %>
      |
      <%= link_to "Delete", 
                   source_path(@source), method: :delete,
                   data: { confirm: "Are you sure you want to delete this source?" } %>
    </p>
  <% end %>

  <table>
    <tr>
      <td><strong>Set: </strong></td>
      <td><%= link_to inline_markdown(@source.source_set.name), source_set_path(@source.source_set)%></td>
    </tr>
    <tr>
      <td><strong>DPLA item URI: </strong></td>
      <td><%= link_to frontend_path('item/' + @source.aggregation), frontend_path(@source.aggregation) %></td>
    </tr>
    <tr>
      <td><strong>Featured? </strong></td>
      <td><%= @source.featured %></td>
    </tr>
  </table>


  <% unless current_admin.reviewer? %>
    <h3>Media assets</h2>

    <p>
      <%= link_to "Add new image", new_image_path(source_id: @source.id) %>
      |
      <%= link_to "Add new document", new_document_path(source_id: @source.id) %>
      |
      <%= link_to "Add new audio", new_audio_path(source_id: @source.id) %>
      |
      <%= link_to "Add new video", new_video_path(source_id: @source.id) %>
    </p>

    <table>

      <% if @source.main_asset.present? %>
        <tr>
          <td><strong>Main media asset (<%= @source.main_asset.class.name %>): </strong></td>
          <td><%= @file_base_or_name %></td>
          <td><%= link_to "View", polymorphic_path(@source.main_asset) %></td>
          <td><%= link_to "Delete", polymorphic_path(@source.main_asset),
                          method: :delete,
                          data: { confirm: "Are you sure you want to delete #{@file_base_or_name}?" } %></td>
        </tr>
      <% end %>

      <% if @source.thumbnails.present? %>
        <tr>
          <td><strong>Thumbnail: </strong></td>
          <td><%= @source.thumbnails.first.file_name %></td>
          <td><%= link_to "View", image_path(@source.thumbnails.first) %></td>
          <td><%= link_to "Delete", image_path(@source.thumbnails.first),
                          method: :delete,
                          data: { confirm: "Are you sure you want to delete #{@source.thumbnails.first.file_name}?" } %></td>
        </tr>
      <% end %>

      <% if @source.small_images.present? %>
        <tr>
          <td><strong>Small image: </strong></td>
          <td><%= @source.small_images.first.file_name %></td>
          <td><%= link_to "View", image_path(@source.small_images.first) %></td>
          <td><%= link_to "Delete", image_path(@source.small_images.first),
                          method: :delete,
                          data: { confirm: "Are you sure you want to delete #{@source.small_images.first.file_name}?" } %></td>
        </tr>
      <% end %>
    </table>
  <% end %>
<% end %>
